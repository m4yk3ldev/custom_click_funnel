<html lang="es">
<head>
    <meta charset="utf-8">
</head>
<body>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
      integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
<script async="async" type="text/javascript">
    !function (f, b, e, v, n, t, s) {
        if (f.fbq) return;
        n = f.fbq = function () {
            n.callMethod ?
                n.callMethod.apply(n, arguments) : n.queue.push(arguments)
        };
        if (!f._fbq) f._fbq = n;
        n.push = n;
        n.loaded = !0;
        n.version = '2.0';
        n.queue = [];
        t = b.createElement(e);
        t.async = !0;
        t.src = v;
        s = b.getElementsByTagName(e)[0];
        s.parentNode.insertBefore(t, s)
    }(window,
        document, 'script', 'https://connect.facebook.net/en_US/fbevents.js');
    fbq('init', '273846641433805');
    fbq('track', 'PageView');
</script>

<noscript><img height="1" width="1" style="display:none"
               src="https://www.facebook.com/tr?id=273846641433805&amp;ev=PageView&amp;noscript=1"/></noscript>


<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-144018341-4"></script>
<script>
    window.dataLayer = window.dataLayer || [];

    function gtag() {
        dataLayer.push(arguments);
    }

    gtag('js', new Date());
    gtag('config', 'UA-144018341-4');
    gtag('event', 'page_view', {
            page_title: document.title,
            page_location: location.href,
            page_path: location.pathname,
            send_to: 'UA-144018341-4'
        }
    );
</script>
<div class="text-center">
    <a href="#" class="btn btn-danger w-100 h-100 d-flex" id="openModalPayu" data-bs-toggle="modal"
       style="font-size: 24px;border-radius: 60px; justify-content: center; align-items: center;"
       data-bs-target="#modalRegisterForm" onclick="AsignValue()" onpress="AsignValue()">Comprar Ya!</a>
</div>


{##}
<div class="modal fade" id="modalRegisterForm" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
     aria-hidden="true" style="color: black">
    <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header text-center">
                <h4 class="modal-title w-100 font-weight-bold" style="font-size: 2rem !important">
                    Por favor agregue los datos de envío
                </h4>
                <button type="button" id="modalClosePayu" class="btn-close" data-bs-dismiss="modal"
                        aria-label="Close"></button>
            </div>
            <div class="modal-body mx-2">
                <form id="formPayu" class="finish-pay" method="post" name="formPayu"
                      action="https://checkout.payulatam.com/ppp-web-gateway-payu/">
                    <input name="merchantId" hidden value="530932"/>
                    <input name="accountId" hidden value="532826"/>
                    <div class="form-group my-2">
                        <label for="payuName" style="font-size: 1rem !important">Nombre</label>
                        <input type="text" required name="payerFullName" class="form-control" id="payuName"
                               aria-describedby="nameHelp"/>
                        <small id="nameHelp" class="form-text text-muted" style="font-size: 0.8rem !important">Nombre
                            completo</small>
                    </div>
                    <div class="form-group my-2">
                        <label for="payuEmail" style="font-size: 1rem !important">Correo</label>
                        <input type="email" required name="buyerEmail" class="form-control" id="payuEmail"
                               aria-describedby="emailHelp"/>
                        <small id="emailHelp" class="form-text text-muted" style="font-size: 0.8rem !important">Correo
                            electrónico</small>
                    </div>
                    <div class="form-group my-2">
                        <label for="payuTelephone" style="font-size: 1rem !important">Teléfono</label>
                        <input type="tel" required name="telephone" class="form-control" id="payuTelephone"
                               aria-describedby="telephoneHelp"/>
                        <small id="telephoneHelp" class="form-text text-muted" style="font-size: 0.8rem !important">Teléfono</small>
                    </div>
                    <input name="shippingCountry" hidden value="CO"/>
                    <div class="form-group my-2">
                        <label for="payuCity" style="font-size: 1rem !important">Ciudad</label>
                        <input type="text" required name="shippingCity" class="form-control" id="payuCity"
                               aria-describedby="cityHelp"/>
                        <small id="cityHelp" class="form-text text-muted" style="font-size: 0.8rem !important">Ciudad de
                            Entrega</small>
                    </div>
                    <div class="form-group my-2">
                        <label for="payuAddress" style="font-size: 1rem !important">Dirección</label>
                        <input type="text" required name="shippingAddress" class="form-control" id="payuAddress"
                               aria-describedby="addressHelp"/>
                        <small id="addressHelp" class="form-text text-muted" style="font-size: 0.8rem !important">Dirección
                            de
                            facturación</small>
                    </div>
                    <input name="description" id="description" hidden/>
                    <input name="referenceCode" id="referenceCode" hidden/>
                    <input name="amount" hidden id="amount"/>
                    <input name="tax" value="0" hidden/>
                    <input name="taxReturnBase" value="0" hidden/>
                    <input name="currency" value="COP" hidden/>
                    <input name="signature" id="signature" hidden/>
                    <input name="test" value="0" hidden/>
                    <input name="responseUrl" value=" https://kiero.co/pay_status?extra4=" hidden/>
                    <input name=" confirmationUrl" value="https://api.kieroapi.net/payuComplete" hidden/>
                    <input type="button" class="button-finish-payu btn btn-primary my-2"
                           value="Continuar con la transacción" onclick="SubmitForm();" onpress="SubmitForm();"/>
                </form>
            </div>
        </div>
    </div>
</div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
        crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.0.0/core.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/3.1.9-1/md5.js"></script>
<script src="https://unpkg.com/axios/dist/axios.min.js"></script>

<script>
    gtag('event', 'view_item', {
        "items": [
            {
                "id": "72550177",
                "name": "GrindMaster-Cecilware CS-LL Traslado térmico radiante, 1.5 galones, acero inoxidable",
                "brand": "Lee Global Imports and Consulting, Inc.",
                "category": "Industria y científico/Equipo y suministros para servicio/Electrodomésticos y equipos para restaurantes/Equipos comerciales para bebidas/Cafeteras comerciales",
                "list_position": 1,
                "quantity": 1,
                "price": '3409158',
                "url": "https://kiero.co/detalle/72550177"
            }
        ]
    });

    function setDiscount(priceProduct, quantityProduct) {
        let discountPercentage = 0;
        if (quantityProduct === 2) {
            discountPercentage = 10;
        }
        if (quantityProduct >= 3) {
            discountPercentage = 15;
        }
        let PriceDiscount =
            priceProduct *
            quantityProduct *
            (1 - parseFloat("." + discountPercentage).toFixed(2));
        PriceDiscount = ~~PriceDiscount;
        return PriceDiscount;
    }

    function handleFormatNumber(number) {
        return number
            .toString()
            .split(".")[0]
            .replace(/(.)(?=(\d{3})+$)/g, "$1.");
    };

    function getDate() {
        let date = new Date();
        let day = date.getDate();
        let month = date.getMonth() + 1;
        let year = date.getFullYear();
        let time = date.toLocaleTimeString();
        if (month < 10) {
            return `${day}-0${month}-${year}-${time}`;
        } else {
            return `${day}-${month}-${year}-${time}`;
        }
    };

    function AsignValue() {
        let ref_code = "kieroco-" + new Date().getTime();
        let discount = setDiscount(3409158, 1);
        let signature = CryptoJS.MD5(
            "uzIc90bkpXj0aJDh22H67MRJnl~530932~" + ref_code + "~" + discount + "~COP"
        );
        document.getElementById("signature").value = signature.toString();
        document.getElementById("amount").value = discount;
        document.getElementById("referenceCode").value = ref_code;
        document.getElementById("description").value = `Opción de accesorios para los cerveceros de café / airpot. Transbordador de acero inoxidable de 1.5 galones (5,7 litros) para mantener una bebida adicional. Contenedor para mantener la bebida adicional lista y disponible para servir.`;

        gtag('event', 'begin_checkout', {
            "checkout_step": 1,
            "checkout_option": "Payu",
            "value": "3409158",
            "items": [
                {
                    "id": "72550177",
                    "name": "GrindMaster-Cecilware CS-LL Traslado térmico radiante, 1.5 galones, acero inoxidable",
                    "brand": "Lee Global Imports and Consulting, Inc.",
                    "category": "Industria y científico/Equipo y suministros para servicio/Electrodomésticos y equipos para restaurantes/Equipos comerciales para bebidas/Cafeteras comerciales",
                    "list_position": 1,
                    "quantity": 1,
                    "price": '3409158',
                    "url": "https://kiero.co/detalle/72550177"
                }
            ]
        });
    }

    async function SendZoho({nombre, apellidos, correo, telephone, ciudad, direccion}) {

        let ref_code = "kieroco-" + new Date().getTime();
        const data = {
            first_name: nombre ?? " ",
            last_name: apellidos,
            city: ciudad,
            address: direccion,
            email: correo,
            second_email: correo,
            phone: telephone,
            second_phone: "",
            type_id: "",
            num_id: "0",
            id: ref_code,
            country: "CO",
            lead_type: "Usuario Registrado que Accedió a los Detalles del Producto",
            brand: "Lee Global Imports and Consulting, Inc.",
            category: "Industria y científico",
            category_id: "16310161",
            sub_category: "Cafeteras comerciales",
            type_client: "standard",
            product_title: 'GrindMaster-Cecilware CS-LL Traslado térmico radiante, 1.5 galones, acero inoxidable',
            product_description: `Opción de accesorios para los cerveceros de café / airpot. Transbordador de acero inoxidable de 1.5 galones (5,7 litros) para mantener una bebida adicional. Contenedor para mantener la bebida adicional lista y disponible para servir.`,
            product_id: "72550177",
            product_image: "https://images-na.ssl-images-amazon.com/images/I/41JeQFvvTVL.jpg",
            main_link: "https://images-na.ssl-images-amazon.com/images/I/41JeQFvvTVL.jpg",
            product_brand: "Lee Global Imports and Consulting, Inc.",
            product_category: "Industria y científico",
            product_subcategory: "Cafeteras comerciales",
            price_product: 3409158,
            rating: "5.0",
            cost_of_goods_sold: "1192387",
            asin_link: "amazon.com/dp/B00DBT6IAI",
            gross_margin: "700290.00",
            gross_margin_percent: "0.21",
            active: true,
            asin: "B00DBT6IAI",
            product_link: "https://kiero.co/detalle/72550177",
            subcategory_link: "kiero.co/categoria/Cafeteras-comerciales",
            margin_percent: "0.37",
            weight: "10.50061753906",
            click_funnel: true,
            funnel_name: "Cafeteras comerciales",
            page_number: "GrindMaster-Cecilware CS-LL Traslado térmico radiante, 1.5 galones, acero inoxidable",
        };
        let urlZoho = "https://api.kieroapi.net/create_lead_zoho";
        let postResp = axios.post(urlZoho, data, {headers: {"Content-Type": "application/json",},})
            .then(function (response) {
                return response.data.status
            })
            .catch(function (error) {
                console.log(error);
                return error
            });
        return postResp
    }


    async function SubmitForm() {
        let nombre = document.getElementById("payuName");
        let correo = document.getElementById("payuEmail");
        let telephone = document.getElementById("payuTelephone");
        let ciudad = document.getElementById("payuCity");
        let direccion = document.getElementById("payuAddress");
        const button = document.getElementsByClassName('button-finish-payu')[0];
        button.value = "Enviando datos ...";
        button.classList.replace("btn-primary", "btn-secondary")
        if (
            nombre.validationMessage === "" &&
            correo.validationMessage === "" &&
            telephone.validationMessage === ""
        ) {
            const fullname = String(nombre.value).split(" ");
            let last_name = " ";
            fullname.map((name, i) => {
                if (i > 0) {
                    last_name += String(name + " ");
                }
            });

            fbq("track", "InitiateCheckout", {
                    content_ids: "72550177",
                    content_name: 'GrindMaster-Cecilware CS-LL Traslado térmico radiante, 1.5 galones, acero inoxidable',
                    product_group: 'Biss',
                    content_type: "product",
                    content_category: "Industria y científico",
                    contents: [
                        {
                            id: "72550177",
                            quantity: 1,
                        },
                    ],
                    currency: "COP",
                    value: 3409158,
                    num_items: 1,
                    em: correo.value ?? " ",
                    ph: 57 + handleFormatNumber(telephone.value ?? " "),
                    event_name: "InitiateCheckout",
                    eventId: "InitiateCheckout_Kiero_Group_2022",
                    user_name: fullname[0] ?? " ",
                    user_last_name: last_name.trim(),
                    timeTransaction: getDate(),
                }
            );
            gtag('event', 'checkout_progress', {
                "checkout_step": 2,
                "checkout_option": "Payu",
                "value": "3409158",
                "items": [
                    {
                        "id": "72550177",
                        "name": "GrindMaster-Cecilware CS-LL Traslado térmico radiante, 1.5 galones, acero inoxidable",
                        "brand": "Lee Global Imports and Consulting, Inc.",
                        "category": "Industria y científico/Equipo y suministros para servicio/Electrodomésticos y equipos para restaurantes/Equipos comerciales para bebidas/Cafeteras comerciales",
                        "list_position": 1,
                        "quantity": 1,
                        "price": '3409158',
                        "url": "https://kiero.co/detalle/72550177"
                    }
                ]
            });
            const responseZoho = await SendZoho({
                nombre: fullname[0],
                apellidos: last_name.trim(),
                correo: correo.value,
                telephone: telephone.value,
                direccion: direccion.value,
                ciudad: ciudad.value,
            });
            const formPayu = document.forms[0];
            responseZoho ? formPayu.submit() : responseZoho
        } else {
            button.value = "Continuar con la transacción";
            button.classList.replace("btn-secondary","btn-primary")
            console.log("Sin datos");
        }
    };
</script>
</body>
</html>